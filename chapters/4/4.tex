\def\latexbokFontdir{../../fonts}
\def\latexbokFiguredir{../../examples}
\documentclass[../../a4.tex]{subfiles}
\begin{document}
\section{Grafik med \LaTeX}\label{sec:4}

\subsection{Vad är bra grafik?}
% Se #26 på bitbucket
\subsubsection{Almänna tips}
\subsubsection{Programspecifika tips}
\subsubsubsection*{Bra \Rlogo-figurer med \texttt{ggplot2}}
\label{sec:ggplot2}
Standardgrafiken i \Rlogo är överlag ganska bra när det gäller statistisk
analys, men bristande på andra områden. På många sätt är det dessutom svårt
att göra lite mer involverade saker som att ändra färger, sätta ordentliga
axlar, enheter och så vidare. \Rlogo-paketet \texttt{ggplot2}
skapades för att åtgärda detta, och skapar snyggare grafer på enklare sätt.

% Fler anledningar:
% * Makes doing the right thing easy, while keeping harder things possible.
% * ggplot2 is an intuitive library that is founded on a logical mapping between data and graphical elements, building plots up not by thinking in terms of dots on paper, but in terms of what the data means. Think about your data and what you want to communicate, not the mechanics of drawing.

Att installera och använda \texttt{ggplot2} är enkelt. Efter att ha installerat
paketet genom att köra kommandot \verb|install.packages("ggplot2")| i \Rlogo
använder man det genom att inkludera paketet och använda funktionen
\texttt{ggplot} i kombination med någon av paketets många plot-funktioner.
Man kan även kombinera olika grafer:
\begin{rcode}
require(ggplot2)
# Exempeldata
df <- data.frame(
+   trt = factor(c(1, 1, 2, 2)),
+   resp = c(1, 5, 3, 4), 
+   group = factor(c(1, 2, 1, 2)),
+   se = c(0.1, 0.3, 0.3, 0.2)
+) 
df2 <- df[c(1,3),] 
# Toppen/botten på errorbars
limits <- aes(ymax = resp + se, ymin=resp - se)
dodge <- position_dodge(width=0.9)
# Plotta!
p <- ggplot(df, aes(fill=group, y=resp, x=trt))
p + geom_bar(position=dodge) +
  + geom_errorbar(limits, position=dodge, width=0.25)
\end{rcode}

En mer utförlig referens över alla kommandon i \texttt{ggplot2} finns på internet%
\footnote{\url{http://had.co.nz/ggplot2/}}, och en grundlig genomgång ges av
\citeasnoun{Hadley09}.
% Att tänka på: ggplot2 
\subsubsubsection*{Bättre \MATLAB-figurer}
% ???

\subsection{Inkludera grafik}
\subsubsection{Paketet \pack{graphicx}}
\subsubsection{Rita med \PGFTikZ}
\subsubsection{Varför hamnar figuren fel?}

\subsection{Exportera grafik}
När man väl skapat sin grafik i det program man arbetar med och är nöjd
med denna måste man exportera den till ett format som kan användas med
\LaTeX. Använder man \pdfLaTeX (vilket man bör) så stöds formaten \JPEG,
\PNG och \PDF. Av dessa lämpar sig \JPEG bäst till fotografier, medan
\PNG och \PDF lämpar sig väl till figurer och grafer.
Generellt sett är \PDF att föredra då formatet är vektorbaserat och
därför kan skalas både upp och ner utan att man förlorar någon kvalitet.

Om möjligheten finns är det bästa dock att exportera sina figurer som
\PGFTikZ-kod, vilket innebär att \LaTeX{} kommer att rendera dem och att
man därför har något större frihet när det gäller finjustering av figuren
i efterhand, och även att axlar och dylikt typsätts på samma sätt som
dokumentets brödtext vilket ger ett enhetligt intryck.

Det finns många (matematiska) programvaror, och det är orimligt att
inkludera instruktioner till alla i detta kapitel. Jag har därför valt
att beskriva hur man enklast exporterar figurer som \PGFTikZ-kod eller
i \PDF-format (i nödfall \PNG) från fyra vanliga programvaror:
\Rlogo, \MATLAB, \Mathematica och \gnuplot.

\subsubsection{Exportera i \PGFTikZ-format}
\PGFTikZ brukar inte vara ett format som normalt stöds av kommersiella
(eller fria) programvaror, och därför är funktionen ofta implementerad
som någon form av tillägg. Lyckligtvis brukar dessa vara öppna och fria
att använda för vem som helst.

\subsubsubsection*{Från \Rlogo med \texttt{tikzDevice}}
\Rlogo-paketet \texttt{tikzDevice} \cite{Sharpsteen12} gör det möjligt
att i \Rlogo exportera figurer som \PGFTikZ-kod. Det kan som många andra
\Rlogo-paket hittas på CRAN och installeras enklast genom att köra
\Rlogo-kommandot \verb|install.packages("tikzDevice")|. Man använder
sedan kommandot \texttt{tikz} för att berätta för \Rlogo att grafiken
ska skrivas som \PGFTikZ-kod, och filen som skapas kan sedan inkluderas
i \LaTeX-dokument med kommandot \cmd{input}.
Exempel~\vref{ex:tikzdevice} visar resultatet av detta.

\begin{kod}[tbp]
	\centering
	\begin{minipage}{\textwidth}
		\centering
		\input{\latexbokFiguredir/4/tikzdevice.tex}
	\end{minipage}
	\\[1ex]
	\begin{minipage}{\textwidth}
		\begin{rcode*}{mathescape=true}
require(tikzDevice)
# width och height specificeras i tum
tikz('figur.tex', width=4, height=2.5)
# exempel med ggplot2, som diskuteras$\text{\vpageref{sec:ggplot2}}$
require(ggplot2)
ggplot(diamonds, aes(depth, fill = cut)) +
  + geom_density(alpha = 0.2) + xlim(55, 70)
# stäng $\text{\TikZ}$-filen
dev.off()
		\end{rcode*}
	\end{minipage}
	\caption{\Rlogo-koden nederst genererar den \PGFTikZ-bild som
	syns överst.}
	\label{ex:tikzdevice}
\end{kod}

\subsubsubsection*{Från \MATLAB med \texttt{matlab2tikz}}
%\subsubsubsection{Från \Mathematica med ???}
\subsubsubsection*{Från \gnuplot med \TikZ-terminalen}

\subsubsection{Exportera i \PDF eller \PNG-fomat}
% Förklara; PDF>PNG eftersom vektorgrafik

\subsubsubsection*{Från \Rlogo till \PDF}
\Rlogo har ett antal inbyggda så kallade enheter \eng{device} som kan
användas för att rita diagram, grafer och liknande, bland annat för \EPS,
\PNG och \textsc{SVG} \cite[s.~713]{RCoreTeam12}. Enheten vi är mest
intresserade av är den som producerar \PDF-filer. Denna används enkelt
genom att köra kommandot \texttt{pdf}, som tar samma parametrar som
\texttt{tikz}-kommandot som beskrevs tidigare. \PDF-filen som genereras
kan sedan enkelt inkluderas i ett \LaTeX-dokument med \cmd{includegraphics}.
Exempel~\vref{ex:pdfdevice} visar hur det kan se ut.

\begin{kod}[tbp]
	\centering
	\begin{minipage}{\textwidth}
		\centering
		\includegraphics{\latexbokFiguredir/4/pdfdevice.pdf}
	\end{minipage}
	\\[1ex]
	\begin{minipage}{\textwidth}
		\begin{rcode*}{mathescape=true}
# width och height specificeras i tum
pdf('figur.tex', width=4, height=2.5)
# exempel med ggplot2, som diskuteras$\text{\vpageref{sec:ggplot2}}$
require(ggplot2)
ggplot(diamonds, aes(depth, fill = cut)) +
  + geom_density(alpha = 0.2) + xlim(55, 70)
# stäng $\text{\PDF}$-filen
dev.off()
		\end{rcode*}
	\end{minipage}
	\caption{\Rlogo-koden nederst genererar den \PDF-bild som
	syns överst.}
	\label{ex:pdfdevice}
\end{kod}

\subsubsubsection*{Från \MATLAB till \PNG}
% Att tänka på: http://tex.stackexchange.com/questions/5559/how-to-avoid-large-margins-around-matlab-plot-in-pdf
\subsubsubsection*{Från \Mathematica till \PDF}
% http://mathematica.stackexchange.com/a/750/1519
\subsubsubsection*{Från \gnuplot till \PDF}

\iffalse
Många dokument kräver att man inkluderar figurer för att presentera
resultat eller förtydliga resonemang. Dessa typsätts i \LaTeX{} med hjälp
av flytande objekt, vilket diskuteras i del~\ref{sec:2}, men i dessa
flytande objekt måste man även importera eller generera sin grafik.

\LaTeX{} ger genom diverse paket många möjligheter att göra detta. Med den
klassiska \LaTeX{}-motorn, som genererar \DVI-filer, kunde man importera
\EPS-filer eller rita direkt med \textsc{PostScript}-kommandon, men
eftersom man i dagsläget oftast använder (och bör använda) \pdfLaTeX{}
måste man använda något annorlunda metoder. Denna del förklarar två av
dessa: \pack{graphicx} och \PGFTikZ.

\subsection{Inkludera grafik med \pack{graphicx}}
Det enklaste sättet att inkludera grafik är att skapa sina figurer i ett
externt program (det kan till exempel vara fördelaktigt att exportera sina
figurer direkt från den programvara man använder) och sedan importera
dessa till \LaTeX{}-dokumentet. Detta gör man med paketet \pack{graphicx}.

Proceduren är enkel:
\begin{enumerate}
	\item Skapa figuren i ett externt program och spara i rätt format
	
	\item Inkludera \pack{graphicx}-paketet genom att skriva
	\cmd{usepackage\{graphicx\}} i inledningen till dokumentet.
	
	\item Inkludera grafiken i en \env{figure}-omgivning med hjälp av
	kommandot \cmd{includegraphics}:
	\latex|\includegraphics[parametrar]{filnamn}|
	
	Parametrarna här kan vara många. Oftast vill man ställa in bredden på
	sin bild så att den passar sidan, och detta kan man göra genom att
	specificera parametern \cli{width} och sätta den till
	\cmd{textwidth}:
	\latex|\includegraphics[width=\textwidth]{filnamn}|
	
	Andra parametrar som kan användas är \cli{height}, \cli{angle}
	och \cli{trim}\footnote{Man bör då inte heller glömma att sätta
	\cli{clip=true}.\hfil}. En komplett beskrivning av paketet och de 
	parametrar som finns att tillgå finns i dokumentationen på
	CTAN\footnote{\url{http://www.ctan.org/archive/macros/latex/required/graphics/grfguide.pdf}}.
\end{enumerate}

Säg att man till exempel vill inkludera filen \cli{interpolation.png}
i sitt dokument för att illustrera konceptet interpolation. Man bestämmer
sig dock för att figuren bara ska ta upp 25\,\% av textbredden, eftersom
figuren bli för stor annars. Man använder då parametern \cli{width}
enligt figur~\vref{fig:graphicx}.% för att specificera detta.

\begin{figure}[tbp]
	\centering
	\hspace{-0.025\textwidth}
	\begin{minipage}{0.475\textwidth} % kod
			%\vfil\cprotect[mm]\ifdraft{\inputminted[frame=single,firstline=10,lastline=17,gobble=2]{latex}{\latexbokFiguredir/4/graphicx.tex}}{\inputminted[frame=single,bgcolor=mintedbg,rulecolor=\color{mintedbg},firstline=10,lastline=17,gobble=2]{latex}{\latexbokFiguredir/4/graphicx.tex}}\vfil
	\end{minipage}
	\hfil
	\begin{minipage}{0.475\textwidth} % figur
		\fbox{\includegraphics[width=\textwidth,clip=true,trim=80 0 80 0]{\latexbokFiguredir/4/graphicx.pdf}}
	\end{minipage}
	\caption{Koden till vänster inkluderar filen \cli{interpolation.png} i
	\LaTeX-dokumentet och ger det resultat som ses till höger.}
	\label{fig:graphicx}
\end{figure}

\subsubsection{Rätt format?}
En nackdel med \pdfLaTeX{} när det gäller \pack{graphicx} är att det inte
finns särskilt många bildformat som fungerar (dock fler än för gamla
\LaTeX{}, som bara accepterade \EPS). De format som kan inkluderas
med \pack{graphicx} när man använder \pdfLaTeX{} är \textsc{PNG},
\textsc{JPEG} och \PDF, och oftast vill man använda \PDF{} för figurer
eftersom
det är det enda vektorbaserade formatet som fungerar, medan man för
fotografier och dylikt använder \textsc{JPEG}. \textsc{PNG} kan man
använda då man egentligen bör använda \PDF{} men detta inte är möjligt.

Eftersom många verktyg och programvaror fortfarande sparar filer i
\EPS-format kan det vara praktiskt att kunna konvertera dessa till ett
format som fungerar. Detta kan göras med verktyget \cli{epstopdf}, som
finns tillgängligt på CTAN.

\subsection{Rita med \PGFTikZ}
Ett lite mer komplicerat sätt att inkludera grafik (men ofta 
föredelaktigt, eftersom allt innehåll stannar i \TeX-filen) är att använda
\PGFTikZ, ett paket skrivet för att användas med \pdfLaTeX{} för att rita
figurer i \LaTeX{}. Med det kan man direkt i sitt \LaTeX-dokument skapa
enklare figurer som flödesscheman, träd, grafer eller liknande; se exempel
i figur~\vref{fig:tikz}. Även mer avancerade figurer är möjliga, men att
förklara hela \PGFTikZ{} tar allt för lång tid för denna introduktion. Den
intresserade läsaren hänvisas istället till \citeasnoun{Mertz07} som har
en bra introduktion till ämnet, och \PGFTikZ-manualen \cite{Tantau10} som
utförligt beskriver hur paketet fungerar.

\begin{figure}[p]
	\centering
	\begin{minipage}{0.95\textwidth} % kod
		\vfil
		\begin{latexcode}
\newcounter{d}\setcounter{d}{0}
\def\mcolor{SpringGreen}
\begin{tikzpicture}
\path[coordinate] (0,0)
     coordinate(A) ++( 60:6cm)
     coordinate(B) ++(-60:6cm) coordinate(C);
\draw[fill=Black!\thed!\mcolor]
     (A) -- (B) -- (C) -- cycle;
\foreach \x in {1,...,15}{%
    \pgfmathsetcounter{d}{\thed+10}
    \setcounter{d}{\thed}
    \path[coordinate] coordinate(X) at (A){};
    \path[coordinate] (A)
         -- (B) coordinate[pos=.15](A)
         -- (C) coordinate[pos=.15](B)
         -- (X) coordinate[pos=.15](C);
    \draw[fill=Black!\thed!\mcolor]
         (A)--(B)--(C)--cycle;
}
\end{tikzpicture}
		\end{latexcode}
		\vfil
	\end{minipage}
	\\[1ex]
	\begin{minipage}{0.95\textwidth} % figur
		\centering
		\newcounter{density}\setcounter{density}{0}
		\begin{minipage}{0.475\textwidth}
		\fbox{\begin{tikzpicture}
		    \path[coordinate] (0,0)  coordinate(A)
		                ++( 60:0.95\textwidth) coordinate(B)
		                ++(-60:0.95\textwidth) coordinate(C);
		    \draw[fill=Black!\thedensity!SpringGreen]
						(A) -- (B) -- (C) -- cycle;
		    \foreach \x in {1,...,15}{%
		        \pgfmathsetcounter{density}{\thedensity+10}
		        \setcounter{density}{\thedensity}
		        \path[coordinate] coordinate(X) at (A){};
		        \path[coordinate] (A) -- (B) coordinate[pos=.15](A)
		                            -- (C) coordinate[pos=.15](B)
		                            -- (X) coordinate[pos=.15](C);
		        \draw[fill=Black!\thedensity!SpringGreen]
						(A)--(B)--(C)--cycle;
		    }
		\end{tikzpicture}}
		\end{minipage}\hfil
		\begin{minipage}{0.475\textwidth}
		\caption[Koden ovan tolkas av \PGFTikZ{} och resulterar i den
		itererade triangeln till vänster]{
		Koden ovan tolkas av \PGFTikZ{} och resulterar i den
		itererade triangeln till vänster.
		Fler exempel finns i
		\citeasnoun{Mertz07} och \citeasnoun{Tantau10}. Tack till Alain 
		Matthes för originalkoden\footnote{\url{http://www.texample.net/tikz/examples/rotated-triangle/}}.}
		\label{fig:tikz}
		\end{minipage}
	\end{minipage}
\end{figure}
\fi
\label{sec:4:end}
\end{document}

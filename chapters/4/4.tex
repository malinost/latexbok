\ifdefined\latexbokFontdir\else\def\latexbokFontdir{../../fonts}\fi
\ifdefined\latexbokFiguredir\else\def\latexbokFiguredir{../../examples}\fi
\documentclass[lang=sv,ptsize=10pt,font=none,nomath,titles=bf,../../a4.tex]{subfiles}
\begin{document}
\section{Grafik med \LaTeX}\label{sec:4}
% Om att man behöver inkludera grafik, att man bör göra det i floats,
% etc.

\subsection{Vad är bra grafik?}
\subsubsection{Almänna tips}
\subsubsection{Programspecifika tips}
\subsubsubsection*{Bra \Rlogo-figurer med \texttt{ggplot2}}
\label{sec:ggplot2}
Standardgrafiken i \Rlogo är överlag ganska bra när det gäller statistisk
analys, men bristande på andra områden. På många sätt är det dessutom 
svårt att göra lite mer involverade saker som att ändra färger, sätta
ordentliga axlar, enheter och så vidare. \Rlogo-paketet \texttt{ggplot2}
skapades för att åtgärda detta, och skapar snyggare grafer på enklare
sätt.

Paketet är intuitivt och baserat på logiska kopplingar mellan data och
grafiska element, vilket gör att man kan bygga grafik genom att tänka
på datans innebörd och vad man vill kommunicera, istället för själva 
grafiken. En bra sammanfattning av paketet, som gör sig bäst på
originalspråket, är \foreignquote{british}{makes doing the right thing
easy, while keeping harder things possible}.

Att installera och använda \texttt{ggplot2} är enkelt. Efter att ha 
installerat paketet genom att köra kommandot
\verb|install.packages("ggplot2")|
i \Rlogo använder man det genom att inkludera paketet och använda
funktionen \texttt{ggplot} i kombination med någon av paketets många
plot-funktioner. Man kan även kombinera olika grafer:
\begin{rcode}
require(ggplot2)
# Exempeldata
df <- data.frame(
+   trt = factor(c(1, 1, 2, 2)),
+   resp = c(1, 5, 3, 4), 
+   group = factor(c(1, 2, 1, 2)),
+   se = c(0.1, 0.3, 0.3, 0.2)
+) 
df2 <- df[c(1,3),] 
# Toppen/botten på errorbars
limits <- aes(ymax = resp + se, ymin=resp - se)
dodge <- position_dodge(width=0.9)
# Plotta!
p <- ggplot(df, aes(fill=group, y=resp, x=trt))
p + geom_bar(position=dodge) +
  + geom_errorbar(limits, position=dodge, width=0.25)
\end{rcode}

En mer utförlig referens över alla kommandon i \texttt{ggplot2} finns
på internet\footnote{\url{http://had.co.nz/ggplot2/}}, och en grundlig
genomgång ges av \textcite{Hadley09}.

\subsubsubsection*{Bättre \MATLAB-figurer}
% ???

\subsection{Inkludera grafik}
Att kunna inkludera grafik av olika slag i sitt dokument kan verka så
vitalt och grundläggande att det rimligtvis inte bör finnas många olika
möjligheter. Så är dock inte fallet. Under den långa tid som \LaTeX{} har
existerat (och utvecklats) har en rad olika metoder för att inkludera
grafik, alla med specifika för- och nackdelar, utvecklats för systemet.

I grunden kan man dock dela upp dessa metoder i två undergrupper: de
paket som inkluderar grafik som skapats av externa program (till
exempel bilder i \PDF-, \PNG- eller \JPEG-format) och de som använder
funktionalitet i den underliggande \TeX-kompilatorn för att skapa grafik.

I den första kategorin finns i princip bara ett alternativ
--- \pack{graphicx}. Den senare kategorin har ett antal kandidater,
men för \pdfLaTeX\ och \XeTeX\ finns det en mycket stark kandidat:
\PGFTikZ. Båda dessa, samt deras för- och nackdelar, diskuteras nedan.

\subsubsection{Paketet \pack{graphicx}}
Den metod som oftast används, eftersom den kräver kortare
kompileringstider och mindre direkt ansträngning, är att inkludera
redan existerande bilder i \PDF- eller \PNG-format med hjälp av
paketet \pack{graphicx}. Paketet har ett mycket enkelt gränssnitt, och
har egentligen bara ett kommando av intresse: \cmd{includegraphics}.

Med hjälp av detta kommando kan man inkludera grafik av format som är
kompatibla med den \TeX-kompilator som används. I fallet \pdfLaTeX\ är
dessa format \PNG, \PDF\ och \JPEG. Kommandot tar ett valfritt
argument, en lista av nycklar, som används för att på olika sätt
skala om bilden som inkluderas, och ett obligatoriskt argument som
berättar var bilden finns:
\latex|\includegraphics[width=\textwidth]{filnamn}|
Fler sådana nycklar listas av \textcite[8\psq]{Carlisle05}.

Fördelen med denna metod är att den i princip \emph{alltid} fungerar,
eftersom nästan alla verktyg kan exportera \PNG- eller \PDF-filer (och
i de fall detta inte går kan man oftast konvertera till \PNG eller i
västa fall använda skärmdumpar). Metoden är såklart också bra för att
inkludera fotografier i \JPEG-format, till exempel bilder på
experimentuppställningar.

Nackdelen är att dessa format inte är vektorbaserade. Detta innebär att
om du behöver skala om bilden i efterhand, så kan grafiken bli suddig
eller otydlig. För till exempel linjediagram och liknande kan dessutom
texten på axlarna bli för liten eller otydlig, vilket såklart gör att
informationen inte kommuniceras lika effektivt. 

Sammanfattat kan man säga att \pack{graphicx} är utmärkt för att
inkludera \JPEG-bilder (dvs. fotografier), medans diagram, grafer och
liknande oftast blir bättre med \PGFTikZ eller \pack{pgfplots}.

\subsubsection{Rita med \PGFTikZ}
En metod som ofta ger bättre resultat, men som är lite mer avancerad att
använda (både eftersom den ger längre kompileringstider och eftersom den
kräver mer arbete av användaren) är att använda \PGFTikZ\ för att rita
den grafik som behövs.

\PGFTikZ\ är ett (mycket stort) paket som används för att rita
vektorgrafik direkt i \LaTeX. Paketet har en omfattande manual
\parencite{Tantau10} som innehåller många väldokumenterade exempel.
Dessutom ges en bra, kortfattad introduktion av \textcite{Mertz07}.
Använder man ett program som kan exportera \PGFTikZ-kod finns det oftast
ingen anledning att inte göra det, och i vissa fall (så som för enkla
figurer över uppställningar eller mekaniska figurer) kan det vara 
lättare att skriva \PGFTikZ-kod än att rita figuren i ett externt program.

Utöver de exempel som finns i manualen går det även att hitta mycket
material på internet\footnote{Bland annat så finns galleriet
\TeX{}ample.net\footref{fn:4:texample}, som innehåller 
många exempel på \PGFTikZ-kod, och taggen \emph{tikz-pgf} på
\TeX.SE\footref{fn:4:tex-se-tikz-pgf}, 
där man kan få svar på många frågor}. Ska man bara rita enkla grafer
finns dessutom det lite enklare paketet \pack{pgfplots}, som använder
\PGFTikZ\ internt (och som diskuteras nedan).%
\silentfootnote{\url{http://www.texample.net}\label{fn:4:texample}}%
\silentfootnote{\url{http://tex.stackexchange.com/questions/tagged/tikz-pgf}\label{fn:4:tex-se-tikz-pgf}}

Fördelen med \PGFTikZ ligger främst i det faktum att grafiken är
vektorbaserad, och därför ser lika bra ut oavsett hur mycket den skalas
om, samt att text i figuren behandlas av \LaTeX\ och därför kommer visas
i rätt typsnitt och vettiga storlekar vilket ökar läsbarheten i figuren.

Den främsta nackdelen är att \PGFTikZ-figurer ofta tar en stund att
kompilera, och att det inte alltid är möjligt att exportera figurer
i det formatet. \PGFTikZ-figurer är alltså att föredra för diagram,
grafer och liknande, men går inte att använda för till exempel
fotografier.

\subsubsubsection*{Plotta med \pack{pgfplots}}
Paketet \pack{pgfplots} kan sägas vara ett tillägg till \PGFTikZ som gör
det lättare att rita vanliga diagram (stapel- eller linjediagram, till
exempel) med hjälp av \PGFTikZ. Bland annat kan \pack{pgfplots} läsa in
data från externa filer och automatiskt omvandla den till figurer.

Paketet har en omfattande manual \parencite{Feuersanger13a}, som
detaljerat beskriver hur man använder paketet för att rita olika
sorters diagram.
Bland annat använder \texttt{matlab2tikz} — som diskuteras på
\cpageref{matlab2tikz} — funktionalitet från \pack{pgfplots}.
Det finns även ett påbyggnadspaket, \pack{pgfplotstable}
\parencite{Feuersanger13b}, som kan läsa
CSV-liknande filer och använda \pack{pgfplots} för att rita diagram
(och tabeller med \pack{booktabs}) utifrån dessa data.

\subsubsection{Varför hamnar figuren fel?}
% Hör inte detta hemma med floats i kapitel 2?

\subsection{Exportera grafik eller data}
När man väl skapat sin grafik i det program man arbetar med och är nöjd
med denna måste man exportera den till ett format som kan användas med
\LaTeX. Använder man \pdfLaTeX (vilket man bör) så stöds formaten \JPEG,
\PNG och \PDF. Av dessa lämpar sig \JPEG bäst till fotografier, medan
\PNG och \PDF lämpar sig väl till figurer och grafer.
Generellt sett är \PDF att föredra då formatet är vektorbaserat och
därför kan skalas både upp och ner utan att man förlorar någon kvalitet.

Om möjligheten finns är det bästa dock att exportera sina figurer som
\PGFTikZ-kod, vilket innebär att \LaTeX{} kommer att rendera dem och att
man därför har något större frihet när det gäller finjustering av figuren
i efterhand, och även att axlar och dylikt typsätts på samma sätt som
dokumentets brödtext vilket ger ett enhetligt intryck. Ett alternativ
till att exportera hela figurer som \PGFTikZ-kod är att exportera datan
i ett format som kan läsas av \pack{pgfplots}, och sedan använda det
paketet för att rita figurerna.

Det finns många (matematiska) programvaror, och det är orimligt att
inkludera instruktioner till alla i detta kapitel. Jag har därför valt
att beskriva hur man enklast exporterar figurer som \PGFTikZ-kod eller
i \PDF-format (i nödfall \PNG) från fyra vanliga programvaror:
\Rlogo, \MATLAB, \Mathematica och \gnuplot.

\subsubsection{Exportera i \PGFTikZ-format}
\PGFTikZ brukar inte vara ett format som normalt stöds av kommersiella
(eller fria) programvaror, och därför är funktionen ofta implementerad
som någon form av tillägg. Lyckligtvis brukar dessa vara öppna och fria
att använda för vem som helst.

\subsubsubsection*{Från \Rlogo med \texttt{tikzDevice}}
\Rlogo-paketet \texttt{tikzDevice} \parencite{Sharpsteen12} gör det möjligt
att i \Rlogo exportera figurer som \PGFTikZ-kod. Det kan som många andra
\Rlogo-paket hittas på CRAN och installeras enklast genom att köra
\Rlogo-kommandot \verb|install.packages("tikzDevice")|. Man använder
sedan kommandot \texttt{tikz} för att berätta för \Rlogo att grafiken
ska skrivas som \PGFTikZ-kod, och filen som skapas kan sedan inkluderas
i \LaTeX-dokument med kommandot \cmd{input}.
\Cref{ex:tikzdevice} visar resultatet av detta.

\begin{kod}[tbp]
	\centering
	\begin{minipage}{\textwidth}
		\centering
		\input{\latexbokFiguredir/4/tikzdevice.tex}
	\end{minipage}
	\\[1ex]
	\begin{minipage}{\textwidth}
		\begin{rcode*}{mathescape=true}
require(tikzDevice)
# width och height specificeras i tum
tikz('figur.tex', width=4, height=2.5)
# exempel med ggplot2, som diskuteras på $\text{\cpageref{sec:ggplot2}}$
require(ggplot2)
ggplot(diamonds, aes(depth, fill = cut)) +
  + geom_density(alpha = 0.2) + xlim(55, 70)
# stäng $\text{\TikZ}$-filen
dev.off()
		\end{rcode*}
	\end{minipage}
	\caption{\Rlogo-koden nederst genererar den \PGFTikZ-bild som
	syns överst.}
	\label{ex:tikzdevice}
\end{kod}

\subsubsubsection*{Från \MATLAB med \texttt{matlab2tikz}}
\label{matlab2tikz}

% OBS FINSLIPA FIGUREN LITE
\begin{kod}[tbp]
	\centering
	\begin{minipage}{\textwidth}
		\centering
		\input{\latexbokFiguredir/4/matlab2tikz.tex}
	\end{minipage}
	\\[1ex]
	\begin{minipage}{\textwidth}
		\begin{matlabcode}
% skapa lite exempeldata
[x, y] = meshgrid(-2:0.2:2,-2:0.2:2);
R = (1./((x+y).^2+(y-x).^2+1).^(1/2));
% plotta figuren
ribbon(R);
xlabel('x'); ylabel('y'); zlabel('z');
% spara figuren i tikz-format
matlab2tikz('figur.tex', 'width', '\textwidth', 'height', '.75\textwidth');
		\end{matlabcode}
	\end{minipage}
	\caption{\MATLAB-koden nederst genererar den \PGFTikZ-bild som
	syns överst.}
	\label{ex:tikzdevice}
\end{kod}

\subsubsubsection*{Från \Mathematica med ???}
\subsubsubsection*{Från \gnuplot med \TikZ-terminalen}

\subsubsection{Exportera i \PDF eller \PNG-fomat}
% Förklara; PDF>PNG eftersom vektorgrafik

\subsubsubsection*{Från \Rlogo till \PDF}
\Rlogo har ett antal inbyggda så kallade enheter \eng{device} som kan
användas för att rita diagram, grafer och liknande, bland annat för \EPS,
\PNG och \textsc{SVG} \parencite[\ppno~675–676]{RCoreTeam12}. Enheten vi är mest
intresserade av är den som producerar \PDF-filer. Denna används enkelt
genom att köra kommandot \texttt{pdf}, som tar samma parametrar som
\texttt{tikz}-kommandot som beskrevs tidigare. \PDF-filen som genereras
kan sedan enkelt inkluderas i ett \LaTeX-dokument med \cmd{includegraphics}.
\Cref{ex:pdfdevice} visar hur det kan se ut.

\begin{kod}[tbp]
	\centering
	\begin{minipage}{\textwidth}
		\centering
		\includegraphics{\latexbokFiguredir/4/pdfdevice.pdf}
	\end{minipage}
	\\[1ex]
	\begin{minipage}{\textwidth}
		\begin{rcode*}{mathescape=true}
# width och height specificeras i tum
pdf('figur.tex', width=4, height=2.5)
# exempel med ggplot2, som diskuteras på $\text{\cpageref{sec:ggplot2}}$
require(ggplot2)
ggplot(diamonds, aes(depth, fill = cut)) +
  + geom_density(alpha = 0.2) + xlim(55, 70)
# stäng $\text{\PDF}$-filen
dev.off()
		\end{rcode*}
	\end{minipage}
	\caption{\Rlogo-koden nederst genererar den \PDF-bild som
	syns överst.}
	\label{ex:pdfdevice}
\end{kod}

\subsubsubsection*{Från \MATLAB till \PNG}
% Att tänka på: http://tex.stackexchange.com/questions/5559/how-to-avoid-large-margins-around-matlab-plot-in-pdf
\subsubsubsection*{Från \Mathematica till \PDF}
% http://mathematica.stackexchange.com/a/750/1519
\subsubsubsection*{Från \gnuplot till \PDF}

\label{sec:4:end}
\end{document}

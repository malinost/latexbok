\makeatletter
% Fix \hologo{XeTeX}
%\def\HoLogo@Xe#1{% 
%   X% 
%   \kern-.1em\relax 
%   \ltx@IfUndefined{HOLOGO@ReflectBox\hologodriver} 
%     {\ltx@IfUndefined{HOLOGO@ReflectBox}\ltx@firstoftwo\ltx@secondoftwo} 
%     \ltx@secondoftwo 
%   {e}{% 
%     \lower.5ex\hbox{% 
%       \HOLOGO@ReflectBox{E}% 
%     }% 
%   }% 
%}
% Force cramped style on inline math
\def\(#1\){\relax\ifmmode\@badmath\else$\fi\cramped{#1}\relax\ifmmode\ifinner $\else\@badmath\fi\else\@badmath\fi}
%\def\(#1\){\relax\ifmmode\@badmath\else$\fi\smash{#1}\relax\ifmmode\ifinner $\else\@badmath\fi\else\@badmath\fi}
% Varioref seems broken with XeLaTeX
\def\reftextfaceafter{på \reftextvario{motstående}{nästa} sida}%
\def\reftextfacebefore{på \reftextvario{motstående}{föregående} sida}%
\def\reftextafter{på \reftextvario{följande}{nästa} sida}%
\def\reftextbefore{på föregående sida}%
\def\reftextcurrent{på denna sida}%
\def\reftextfaraway#1{{på sidan~\pageref{#1}}}%
\def\reftextpagerange#1#2{{på sidorna~\pageref{#1}–\pageref{#2}}}%
\def\reftextlabelrange#1#2{{\ref{#1} till~\ref{#2}}}%
\DeclareRobustCommand\Vref{\@ifstar{\let\vref@space\relax\Vr@f}{\let\vref@space~\Vr@f}}
\DeclareRobustCommand\vref{\@ifstar{\let\vref@space\relax\vr@f}{\let\vref@space~\vr@f}}
% Twoside
\@twosidetrue
% Listings
\newcommand{\kodname}{Exempel}
\newcounter{kod}\renewcommand\thekod{\@arabic\c@kod}
\def\fps@kod{tb}
\def\ftype@kod{3}
\def\ext@kod{lok}
\def\fnum@kod{\kodname~\thekod}
\newenvironment{kod}{\@float{kod}}{\end@float}
\newenvironment{kod*}{\@dblfloat{kod}}{\end@dblfloat}
\newsubfloat{kod}
% Displaying one line of code
\newcommand\kodrad[2]{\hspace{1ex}\inputminted[firstline=#1,lastline=#1]{latex}{#2.tex}}
% Redefining sections to break page
\let\section@old=\section
\renewcommand\section{\@ifstar\my@section@star\my@section}
\newcommand\my@section[2][\@empty]{\cleardoublepage\vspace*{2\bigskipamount}\ifx\@empty#1\section@old{#2}\else\section@old[#1]{#2}\fi}
\newcommand\my@section@star[2][\@empty]{\cleardoublepage\vspace*{2\bigskipamount}\ifx\@empty#1\section@old*{#2}\else\section@old*[#1]{#2}\fi}
% Front/main/backmatter
\newcommand\frontmatter{%
  \cleardoublepage
  \pagenumbering{roman}}
\newcommand\mainmatter{%
  \cleardoublepage
  \pagenumbering{arabic}}
\newcommand\backmatter{%
  \cleardoublepage
}
% Maketitle without newpage
\newcommand\maketitlennp{\par%
  \begingroup
    \renewcommand\thefootnote{\@fnsymbol\c@footnote}%
    \def\@makefnmark{\rlap{\@textsuperscript{\normalfont\@thefnmark}}}%
    \long\def\@makefntext##1{\parindent 1em\noindent%
      \hb@xt@1.8em{\hss\@textsuperscript{\normalfont\@thefnmark}}##1}%
    \global\@topnum\z@
    \@maketitlennp
    \thispagestyle{empty}\@thanks
  \endgroup
  \setcounter{footnote}{0}
}
\def\@maketitlennp{%
  \null
  \begin{flushleft}%
\vspace{-\headsep}
    {\small%
      \if\@regarding\relax\else\@regarding{, }\fi%
      \@date\par%
    }%
    \vspace{1.5cm}%
    {\Huge\@titstyle\@title\par}%
    \vspace{.125cm}%
    {\Large\@titstyle\@author}%
    \vspace{.75cm}%
  \end{flushleft}%
  \par%
}
% Changes to titlepage environment (don't reset pagenumbering before)
\renewenvironment{titlepage}{\cleardoublepage}{\thispagestyle{skrapport@titlepage}\cleardoublepage\setcounter{page}\@ne}
% TexorPDF version of LaTeX and AmS logo
\let\@oldLaTeX\LaTeX
\def\LaTeX{\texorpdfstring{\@oldLaTeX}{LaTeX}}
\let\@oldAmS\AmS
\def\AmS{\texorpdfstring{\@oldAmS}{AMS}}
% File last modified
\def\parsedate #1:2#2#3#4#5#6#7#8#9\empty{\ifx{#2}{9}19\else20\fi#3#4/#5#6/#7#8}
\newcommand\moddate[1][\jobname.tex]{\expandafter\parsedate\pdffilemoddate{#1}\empty}
% Minted background fix
\renewenvironment{minted@colorbg}[1]{%
	\par%
	\def\minted@bgcol{#1}%
	\noindent\begin{lrbox}{\minted@bgbox}%
	\begin{minipage}{\linewidth-2\fboxsep}%
}{%
	\end{minipage}%
	\end{lrbox}%
	\colorbox{\minted@bgcol}{\usebox{\minted@bgbox}}%
	\par%
}
\makeatother
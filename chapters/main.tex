\RequirePackage[draft]{ifdraft}
\RequirePackage{xstring,xparse}
\NewDocumentCommand\paper{mm}{\IfStrEq{\papersize}{#1}{#2}{}}
\PassOptionsToPackage{usenames,dvipsnames}{xcolor}
\PassOptionsToPackage{quiet}{fontspec}
\documentclass[lang=sv,ptsize=10pt,font=none,nomath,titles=bf]{skrapport}
%% Packages
\input{chapters/packages.tex}
%% Draft fixes to minted, tikz
\input{chapters/draft.tex}
%% FONT SELECTION
\input{chapters/fonts.tex}
%% Hacks
\input{chapters/hacks.tex}
%% Convenient definitions
\input{chapters/definitions.tex}
%% Redefinitions of style
\input{chapters/style.tex}

%% Load the bibliography data
\addbibresource{referenser.bib}

%% METADATA
\title{Att \hologo{TeX}a: en praktisk guide}
\author{Simon Sigurdhsson}
\regarding{Nybörjarguide i \hologo{LaTeX}, andra upplagan.}
\date{}

%% Actual document
\begin{document}
	%% Title page
	\subfile{chapters/meta/titlepage.tex}
	\cleardoublepage 
	%% Table of contents
	\frontmatter
	\pagestyle{thefancy}
	\begingroup
		\ExplSyntaxOn
		\cs_set_eq:NN\__old_pack\pack
		\cs_set_eq:NN\__old_cmd\cmd
		\cs_set_eq:NN\__old_env\env
		\DeclareDocumentCommand\pack{som}{\textsf{#3}}
		\DeclareDocumentCommand\cmd{som}{\texttt{\textbackslash{}#3}}
		\DeclareDocumentCommand\env{som}{\texttt{#3}}
		\ExplSyntaxOff
		\tableofcontents
		\ExplSyntaxOn
		\cs_set_eq:NN\pack\__old_pack
		\cs_set_eq:NN\cmd\__old_cmd
		\cs_set_eq:NN\env\__old_env
		\ExplSyntaxOff
	\endgroup
	\cleardoublepage
	\mainmatter
	%% INLEDNING
	\subfile{chapters/0/0.tex}
	%% GRUNDLÄGGANDE BEGREPP
	\subfile{chapters/1/1.tex}
	%% TYPSÄTTNING MED LATEX
	\subfile{chapters/2/2.tex}
	%% MATEMATIK MED LATEX OCH AMS
	\subfile{chapters/3/3.tex}
	%% GRAFIK MED LATEX
	\subfile{chapters/4/4.tex}
	%% REFERENSER MED BIBTEX
	\subfile{chapters/5/5.tex}
	%% VIDARE LÄSNING
	\subfile{chapters/6/6.tex}
	%% BIBLIOGRAFI
	\cleardoublepage
	\let\oldurl=\url
	\paper{a4}{\renewcommand\url[1]{\mbox{\small\oldurl{#1}}}}
	\paper{c5}{\renewcommand\url[1]{\mbox{\footnotesize\texttt{\oldurl{#1}}}}}
	\defbibheading{bibliography}[\bibname]{\nntocsection{#1}}
	\printbibliography
	\let\url\oldurl
	%% INDEX
	% korsrefererande index
	\index{mellanrum|see{tomrum}}
	\index{pdfLaTeX@\pdfLaTeX{}|see{kompilator, \pdfLaTeX{}}}
	\index{LuaLaTeX@\hologo{LuaLaTeX}|see{kompilator, \hologo{LuaLaTeX}}}
	\index{XeLaTeX@\hologo{XeLaTeX}|see{kompilator, \hologo{XeLaTeX}}}
	\index{CTAN|see{Comprehensive \TeX{} Archive Network, The}}
	\index{separation!mellanrum|see{tomrum}}
	\index{nyradstecken|see{tomrum, nyradstecken}}
	\index{och-tecken|see{specialtecken}}
	\index{\&!i text|see{specialtecken}}
	\index{\&!i tabell|see{tabell}}
	\index{procenttecken|see{specialtecken}}
	\index{\%!i text|see{specialtecken}}
	\index{\%!i \LaTeX-kod|see{kommentar}}
	\index{dollartecken|see{specialtecken}}
	\index{\$!i text|see{specialtecken}}
	\index{\$!matematikläge|see{matematikläge}}
	\index{frivillig parameter|see{parameter}}
	\index{obligatorisk parameter|see{parameter}}
	\index{klass|see{dokumentklass}}
	\index{pappersstorlek|see{inställning, standardklass}}
	\index{textstorlek!dokumentnivå|see{inställning, standardklass}}
	\index{kommando!textstorlek|see{textstorlek, kommando}}
	\index{texdoc@\texttt{texdoc}|see{paket, dokumentation}}
	\index{tlmgr@\texttt{tlmgr}|see{paket, installera}}
	\index{dokumentation!paket|see{paket, dokumentation}}
	\index{installera!paket|see{paket, installera}}
	\index{kompilera|see{\PDF, kompilera till}}
	\index{kompilera!automatiskt|see{\cli{latexmk}}}
	\index{filtyp!sty@\texttt{.sty}|see{paket}}
	\index{filtyp!cls@\texttt{.cls}|see{dokumentklass}}
	\index{filtyp!pdf@\texttt{.pdf}|see{\PDF}}
	%
	\cleardoublepage
	\indexprologue{\label{sec:idx}
		Detta register innehåller en förteckning över olika teman, termer
		och liknande som diskuteras i boken. Den innehåller inte en
		förteckning över de \LaTeX-paket som diskuteras (en sådan återfinns
		på~\cpageref{sec:idx-pkg}) eller de kommandon och miljöer som nämns
		(en förteckning över dessa finns på~\cpageref{sec:idx-cmd}).
	}
	\printindex
	\cleardoublepage
	\indexprologue{\label{sec:idx-pkg}
		Denna förteckning listar alla de \LaTeX-paket som nämns i boken.
	}
	\printindex[packages]
	\cleardoublepage
	\indexprologue{\label{sec:idx-cmd}
		Denna förteckning listar alla de kommandon och mijöer som 
		diskuteras i boken.
	}
	\printindex[macros]
	%% EN ENKEL MALL
	\cleardoublepage
	\appendix
	\subfile{chapters/meta/appendix.tex}
	\backmatter
\end{document}
